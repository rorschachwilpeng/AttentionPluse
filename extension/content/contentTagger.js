/**
 * ContentTagger.js - 深度强化版 (30 Tags / 2500+ Keywords)
 * 支持多重权重计算、#号话题加权匹配
 */

class ContentTagger {
  constructor() {
    // 1. 30个原子级内容标签
    this.TAGS = {
      TECH: 'tech',           // 科技/极客
      LEARNING: 'learning',   // 学习/干货
      FINANCE: 'finance',     // 财经/理财
      CAREER: 'career',       // 职场/职场
      HEALTH: 'health',       // 健康/医疗
      SPORTS: 'sports',       // 运动/健身
      OUTDOOR: 'outdoor',     // 户外/露营
      AUTO: 'auto',           // 汽车/机车
      GAME: 'game',           // 游戏/电竞
      MOVIE: 'movie',         // 影视/剧播
      BOOK: 'book',           // 书籍/文学
      ART: 'art',             // 艺术/审美
      DESIGN: 'design',       // 设计/创意
      PHOTO: 'photo',         // 摄影/影像
      FASHION: 'fashion',     // 时尚/穿搭
      BEAUTY: 'beauty',       // 美妆/护肤
      FOOD: 'food',           // 美食/料理
      TRAVEL: 'travel',       // 旅行/探店
      HOME: 'home',           // 家居/生活方式
      PETS: 'pets',           // 宠物/萌宠
      PARENTING: 'parenting', // 母婴/育儿
      EMOTION: 'emotion',     // 情感/治愈
      RELATIONSHIP: 'relation', // 人际/社交
      LIFE: 'life',           // 日常/随手拍
      NEWS: 'news',           // 社会/新闻
      SCIENCE: 'science',     // 科学/科普
      HISTORY: 'history',     // 历史/考古
      REAL_ESTATE: 'estate',  // 房产/置业
      LEGAL: 'legal',         // 法律/咨询
      OTHER: 'other',         // 其他/杂项
      UNKNOWN: 'unknown'      // 未知
    };
    
    // 2. 特征词库 (每个类目 80-100 词)
    this.keywords = {
      [this.TAGS.TECH]: [
        '技术', '编程', '代码', '开发', '软件', '硬件', '程序员', '码农', '工程师', '架构',
        'AI', '人工智能', '机器学习', '深度学习', 'GPT', '大模型', 'LLM', 'AIGC', 'ChatGPT', 'Claude',
        'Midjourney', 'StableDiffusion', 'Prompt', '提示词', '算法', '前端', '后端', '全栈', 
        'Python', 'Java', 'JavaScript', 'TypeScript', 'React', 'Vue', 'Rust', 'Golang', 'Linux',
        '云计算', 'AWS', 'Azure', 'Docker', 'K8s', '容器', '区块链', 'Web3', '加密货币', '数字货币',
        '以太坊', '比特币', '芯片', '半导体', '英伟达', '显卡', 'GPU', 'CPU', '自动化', '物联网',
        'IoT', '5G', '效率工具', 'Notion', 'Obsidian', '飞书', '智能家居', '量子计算', '元宇宙',
        'GitHub', '开源', '部署', '运维', '数据库', 'SQL', '爬虫', '大数据', '数据分析', '清洗数据',
        '网络安全', '黑客', '白帽子', '渗透测试', 'API', '文档', '重构', 'Debug', '报错', '兼容性',
        '分布式', '缓存', '服务器', '域名', '网站', '微服务', '低代码', 'SAAS', 'PAAS', 'IAAS'
      ],
      
      [this.TAGS.LEARNING]: [
        '学习', '教程', '攻略', '干货', '知识', '教育', '笔记', '方法', '心得', '复习', '预习',
        '考研', '公考', '事业编', '教资', '考证', 'CPA', '雅思', '托福', '四六级', 'GRE', 'GMAT',
        '学习打卡', '自律', '专注', '深度学习', '番茄钟', '英语', '听力', '口语', '单词', '语法',
        '日语', '韩语', '德语', '法语', '俄语', '阅读', '速度', '精读', '早读', '晚自习', '图书馆',
        '书单', '文学', '历史', '哲学', '心理学', '社会学', '经济学', '方法论', '知识管理', '思维导图',
        '成长', '能力', '素养', '证书', '学历', '博士', '硕士', '研究生', '技能', '培训', '网课',
        '学术', '论文', '期刊', 'SCI', '研究', '实验室', '开题报告', '文献', '知网', '万方',
        'Excel', 'PPT', 'Office', 'Word', '软件教程', '自学', '公开课', 'MOOC', '讲座', '研讨会'
      ],

      [this.TAGS.FINANCE]: [
        '财经', '金融', '理财', '投资', '股票', '基金', '黄金', '存款', '攒钱', '记账', '账本',
        '资产', '负债', '现金流', '利息', '复利', '通胀', '通缩', '宏观', '微观', '牛市', '熊市',
        'A股', '美股', '港股', '纳斯达克', '道琼斯', '定投', '调仓', '加仓', '减仓', '解套', '止盈',
        '止损', '收益率', '分红', '股息', '开户', '券商', '研报', '技术指标', 'K线', '均线', '交易',
        '期权', '期货', '外汇', '养老金', '保险', '重疾险', '寿险', '医疗险', '社保', '公积金',
        '个税', '起征点', '房贷', '汇率', '利率', '降准', '加息', '量化投资', '价值投资', '风险控制',
        '投行', '投顾', '银行', '贷款', '信用卡', '额度', '分期', '征信', '黑名单', '财富自由',
        '省钱', '薅羊毛', '优惠券', '折扣', '特价', '消费降级', '消费主义', '金融史', '华尔街'
      ],

      [this.TAGS.SPORTS]: [
        '运动', '健身', '锻炼', '减肥', '瘦身', '塑形', '减脂', '增肌', '腹肌', '马甲线', '体脂',
        '跑步', '跑鞋', '马拉松', '半马', '全马', '配速', '越野', '骑行', '公路车', '单车', '山地车',
        '游泳', '潜水', '冲浪', '浆板', '滑雪', '单板', '双板', '冰雪', '瑜伽', '普拉提', '拉伸',
        '健身房', '私教', '器械', '力量训练', '核心训练', '体能', '耐力', '爆发力', '八段锦', '太极',
        '篮球', '球鞋', '足球', '排球', '网球', '羽毛球', '乒乓球', '高尔夫', '棒球', '冰球', '保龄球',
        '陆冲', '滑板', '轮滑', '攀岩', '抱石', '格斗', '拳击', '散打', '柔术', '泰拳', '剑道',
        '运动打卡', '健身餐', '蛋白粉', '补剂', '肌酸', '左旋', '筋膜枪', '护具', '运动装', '装备清单',
        '低卡饮食', '轻食', '控糖', '断食', '生酮', 'BMI', '基础代谢', '新陈代谢', '有氧', '无氧'
      ],

      [this.TAGS.GAME]: [
        '游戏', '电竞', '手游', '端游', '单机', '主机', 'Steam', 'Epic', 'PS5', 'Switch', 'Xbox',
        '任天堂', '索尼', '育碧', '米哈游', '暴雪', '腾讯游戏', '网易游戏', '开发者', '独立游戏',
        '王者荣耀', '原神', '和平精英', '英雄联盟', 'LOL', '绝地求生', '吃鸡', '永劫无间', '暗黑',
        '黑神话', '悟空', '老头环', '艾尔登法环', '塞尔达', '马里奥', '口袋妖怪', '宝可梦', '动森',
        '竞技', '排位', '段位', '王者', '青铜', '白银', '上分', '掉分', '代练', '皮肤', '抽卡',
        '保底', '概率', '副本', 'BOSS', '攻略', '通关', '速通', '二周目', '彩蛋', '隐藏', 'MOD',
        '外挂', '防封', '封号', '实战', '复盘', '直播', '主播', '解说', '职业选手', 'TI', 'S14',
        '游戏圈', '玩家', '硬核', '云玩家', '情怀', '重制版', 'DLC', '内测', '公测', '跳票'
      ],

      [this.TAGS.FOOD]: [
        '美食', '烹饪', '食谱', '料理', '烘焙', '咖啡', '奶茶', '下午茶', '夜宵', '探店', '本地推荐',
        '餐厅', '米其林', '黑珍珠', '网红打卡', '零食', '甜点', '蛋糕', '减脂餐', '深夜食堂', '家常菜',
        '火锅', '烧烤', '日料', '韩料', '西餐', '泰餐', '川菜', '粤菜', '湘菜', '鲁菜', '淮扬菜',
        '面条', '米饭', '面包', '披萨', '汉堡', '炸鸡', '奶酪', '甜品', '提拉米苏', '布丁', '冰淇淋',
        '调料', '食材', '蔬菜', '肉类', '海鲜', '生鲜', '自制', '大餐', '聚餐', '团年饭', '一人食',
        '空气炸锅', '破壁机', '烤箱', '铸铁锅', '厨具', '洗碗机', '冰箱', '储鲜', '超市', '菜市场',
        '路边摊', '大排档', '小吃', '非遗美食', '特产', '伴手礼', '外卖', '点评', '避雷', '拔草',
        '吃相', '吃播', '大胃王', '测评', '红黑榜', '口感', '味道', '酸辣', '甜咸', '麻辣'
      ],

      [this.TAGS.AUTO]: [
        '汽车', '机车', '跑车', '家用车', 'SUV', '轿车', '越野车', 'MPV', '纯电', '混动', '增程',
        '新能源', '特斯拉', '比亚迪', '蔚小理', '理想', '蔚来', '小鹏', '小米汽车', '华为', '智选',
        '动力', '马力', '扭矩', '百公里加速', '续航', '电池', '充电桩', '超充', '换电', '芯片',
        '智能座舱', '自动驾驶', '智驾', '雷达', '避震', '改色膜', '贴膜', '内饰', '皮革', '轮毂',
        '刹车', '改装', '低趴', '姿态', '声浪', '排气', '机油', '保养', '洗车', '美容', '车展',
        '上市', '价格', '落地价', '保险', '驾照', '路考', '老司机', '新手', '女司机', '女骑',
        '摩托车', '重机', '头盔', '骑行服', '压弯', '摩旅', '进藏', '自驾游', '路书', '导航',
        '自动挡', '手动挡', '换挡', '漂移', '赛道', 'F1', '纽北', '碰撞测试', '安全', '二手车'
      ],

      [this.TAGS.LEGAL]: [
        '法律', '咨询', '律师', '法官', '检察官', '法学生', '法考', '刑法', '民法典', '合同法',
        '劳动法', '公司法', '知识产权', '著作权', '商标', '专利', '侵权', '官司', '诉讼', '仲裁',
        '起诉', '调解', '判决', '证据', '法庭', '辩护', '公证', '见证', '维权', '投诉', '举报',
        '遗产', '继承', '婚姻法', '离婚', '抚养权', '财产分割', '彩礼', '协议', '遗嘱', '赔偿',
        '欠款', '借条', '高利贷', '非法集资', '诈骗', '反诈', '强制执行', '老赖', '破产', '清算',
        '底线', '正义', '法理', '情理', '大案', '普法', '讲座', '罗翔', '法治', '权利', '义务'
      ],

      [this.TAGS.REAL_ESTATE]: [
        '房产', '置业', '买房', '卖房', '租房', '中介', '看房', '刚需', '改善', '楼盘', '新房',
        '二手房', '学区房', '地铁房', '精装', '毛坯', '户型', '朝向', '采光', '楼层', '公摊',
        '得房率', '容积率', '绿化', '物业', '业主', '收房', '验房', '烂尾', '断供', '房贷',
        '首付', '公积金', '月供', '利息', '利率', '降准', '限购', '限售', '土地', '土拍',
        '开发商', '万科', '恒大', '碧桂园', '龙湖', '保利', '链家', '贝壳', '安居客', '中原',
        '房价', '涨幅', '跌幅', '中轴线', 'CBD', '郊区', '学区', '学位', '过户', '契税',
        '房产证', '土地证', '不动产', '抵押', '查封', '法拍', '公寓', '别墅', '洋房', '合租'
      ],

      [this.TAGS.OUTDOOR]: [
        '户外', '露营', 'Glamping', '帐篷', '睡袋', '天幕', '营地', '野炊', '焚火', '卡式炉',
        '钓鱼', '路亚', '台钓', '海钓', '渔具', '鱼竿', '鱼线', '鱼钩', '中鱼', '空军', '黑坑',
        '徒步', '登山', '攀岩', '越野', '溯溪', '漂流', '桨板', '冲浪', '潜水', '风帆', '风筝',
        '观星', '极光', '日出', '日落', '云海', '自然', '地理', '森林', '草原', '雪山', '荒野',
        '生存', '求生', '贝爷', '探险', '探洞', '户外装备', '冲锋衣', '始祖鸟', 'Lululemon', 'Patagonia',
        '北面', '猛犸象', '登山鞋', '背包', '过滤水器', '指南针', 'GPS', '路网', '轨迹', '无人区'
      ],

      [this.TAGS.HEALTH]: [
        '健康', '养生', '医疗', '医学', '医院', '医生', '护士', '体检', '检查', '诊断',
        '疾病', '慢性病', '亚健康', '免疫力', '抵抗力', '炎症', '感染', '病毒', '细菌', '流感',
        '新冠', '疫苗', '接种', '药物', '用药', '处方', '副作用', '禁忌', '剂量', '疗程',
        '中医', '西医', '中药', '西药', '针灸', '推拿', '艾灸', '理疗', '康复', '复健',
        '营养', '饮食', '膳食', '营养素', '维生素', '蛋白质', '钙', '铁', '锌', 'Omega-3',
        '作息', '睡眠', '失眠', '熬夜', '打鼾', '呼吸暂停', '焦虑', '抑郁', '压力', '心理健康',
        '情绪', '心理咨询', '心理医生', '精神科', '心率', '血压', '血糖', '血脂', 'BMI',
        '心脏', '肝脏', '肾脏', '胃', '肠道', '消化', '代谢', '内分泌', '激素', '甲状腺'
      ],

      [this.TAGS.MOVIE]: [
        '电影', '电视剧', '剧集', '影视', '院线', '上映', '首映', '点映', '票房', '排片',
        '导演', '编剧', '制片人', '演员', '主演', '配角', '演技', '台词', '表演', '角色',
        '剧情', '情节', '反转', '结局', '伏笔', '叙事', '节奏', '剪辑', '运镜', '镜头语言',
        '摄影', '美术', '服化道', '配乐', '原声', 'OST', '音效', '特效', 'CG', '视效',
        '科幻片', '悬疑片', '恐怖片', '爱情片', '喜剧', '动作片', '战争片', '文艺片',
        '国产剧', '美剧', '韩剧', '日剧', '英剧', '网飞', 'Netflix', 'HBO', '爱奇艺', '腾讯视频',
        '优酷', '芒果TV', '豆瓣', '评分', '口碑', '影评', '解析', '解说', '拉片', '彩蛋',
        'IP', '原著', '改编', '续集', '前传', '番外', '系列', '宇宙', '爆款', '烂片'
      ],

      [this.TAGS.BOOK]: [
        '书籍', '读书', '阅读', '书评', '书单', '好书推荐', '文学', '小说', '散文', '诗歌',
        '随笔', '传记', '纪实文学', '非虚构', '虚构', '世界名著', '经典', '畅销书', '新书',
        '作者', '作家', '文笔', '语言', '叙事', '结构', '主题', '隐喻', '象征', '意象',
        '人物', '角色', '情节', '故事', '视角', '第一人称', '第三人称', '意识流',
        '哲学', '心理学', '社会学', '历史', '文化', '思想', '观念', '价值观',
        '成长', '治愈', '焦虑', '孤独', '人性', '命运', '女性主义', '现实主义', '浪漫主义',
        '推理', '悬疑', '科幻', '奇幻', '魔幻现实主义', '乌托邦', '反乌托邦',
        '出版社', '译者', '翻译', '版本', '精装', '平装', '电子书', 'Kindle', '微信读书',
        '豆瓣读书', '划线', '笔记', '摘抄', '重读'
      ],

      [this.TAGS.ART]: [
        '艺术', '审美', '美学', '艺术史', '当代艺术', '现代艺术', '古典艺术',
        '绘画', '油画', '水彩', '素描', '版画', '壁画', '雕塑', '装置艺术',
        '艺术家', '大师', '画家', '创作者', '风格', '流派', '印象派', '表现主义',
        '超现实主义', '抽象', '具象', '极简主义', '后现代',
        '色彩', '构图', '光影', '线条', '质感', '形式', '符号', '隐喻',
        '策展', '展览', '美术馆', '博物馆', '画廊', '双年展', '艺术节',
        '艺术评论', '批评', '理论', '观念', '表达', '情绪',
        '审丑', '高级感', '视觉', '感官', '体验',
        '国画', '书法', '篆刻', '水墨', '写意', '工笔',
        '艺术教育', '艺术留学', '作品集', '创作'
      ],

      [this.TAGS.DESIGN]: [
        '设计', '创意', '视觉设计', '平面设计', 'UI设计', 'UX设计', '交互设计',
        '产品设计', '工业设计', '空间设计', '室内设计',
        '版式', '排版', '构图', '色彩', '字体', '字形', '图形', '图标',
        '品牌', '品牌设计', 'VI', 'LOGO', '标志', '识别系统',
        '海报', '画册', '包装', '广告', 'KV', '物料',
        '网页设计', 'App设计', 'B端', 'C端',
        '设计系统', '组件', '规范', 'Design System',
        'Figma', 'Sketch', 'Adobe', 'Photoshop', 'Illustrator', 'XD',
        '灵感', '参考', 'Behance', 'Dribbble', '站酷',
        '创作', '审美', '风格', '趋势', '流行', '极简', '拟物',
        '动效', 'Motion', 'AE', 'Lottie',
        '设计师', '改稿', '甲方', '需求'
      ],

      [this.TAGS.PHOTO]: [
        '摄影', '拍照', '影像', '照片', '相机', '镜头', '快门', '光圈', 'ISO',
        '曝光', '测光', '对焦', '虚化', '景深', '构图', '取景',
        '光影', '色彩', '白平衡', '动态范围',
        '人像', '风光', '街拍', '纪实', '人文', '静物', '产品摄影',
        '夜景', '星空', '延时', '慢门', '长曝光',
        '单反', '微单', '无反', '卡片机', '胶片',
        '索尼', '佳能', '尼康', '富士', '徕卡',
        'RAW', 'JPG', '调色', '后期', '修图',
        'Lightroom', 'Photoshop', 'VSCO',
        '预设', '滤镜', '风格化',
        '航拍', '无人机', '大疆',
        '摄影师', '作品', '投稿', '参赛',
        '摄影集', '摄影展', '视觉叙事'
      ],

      [this.TAGS.FASHION]: [
        '时尚', '穿搭', '搭配', '造型', '风格', '潮流', '趋势',
        '日常穿搭', '通勤', '休闲', '街头', '复古', '极简', '甜酷',
        '服装', '上衣', '下装', '外套', '连衣裙', '西装', '风衣',
        '牛仔', '针织', '衬衫', 'T恤', '卫衣',
        '鞋子', '球鞋', '运动鞋', '皮鞋', '靴子',
        '包包', '配饰', '帽子', '围巾', '首饰',
        '显瘦', '显高', '比例', '身材',
        '色彩', '配色', '叠穿',
        '品牌', '奢侈品', '轻奢', '快时尚',
        'OOTD', 'Lookbook',
        '男装', '女装', '中性风',
        '换季', '衣橱', '断舍离',
        '时装周', '秀场', '模特'
      ],

      [this.TAGS.BEAUTY]: [
        '美妆', '护肤', '化妆', '素颜', '妆容', '妆感',
        '底妆', '粉底', '气垫', '遮瑕', '散粉',
        '眼妆', '眼影', '眼线', '睫毛', '眉毛',
        '唇妆', '口红', '唇釉', '腮红', '修容', '高光',
        '肤质', '干皮', '油皮', '混油', '敏感肌',
        '清洁', '卸妆', '洗面奶',
        '水', '精华', '乳液', '面霜', '防晒',
        '刷酸', '维A', '烟酰胺', '玻尿酸', 'VC',
        '抗老', '美白', '祛痘', '修复',
        '医美', '皮肤科', '光子', '水光',
        '品牌', '成分党', '测评',
        '种草', '拔草', '回购',
        '化妆刷', '美妆蛋',
        '妆前', '定妆'
      ],

      [this.TAGS.TRAVEL]: [
        '旅行', '旅游', '出行', '攻略', '行程', '路线', '计划', '自由行', '跟团', '定制游',
        '城市', '目的地', '打卡', '网红地', '小众', '宝藏', '避坑', '避雷',
        '酒店', '民宿', '青旅', '露营', '入住', '退房', '早餐',
        '机票', '航班', '高铁', '火车', '动车', '租车', '自驾',
        '签证', '护照', '过关', '海关', '边检',
        '景点', '门票', '排队', '预约', '人少',
        '拍照', '出片', '风景', '夜景', '日出', '日落',
        '探店', '咖啡馆', '酒吧', '餐厅', '当地美食',
        'citywalk', '徒步', '漫游',
        '文化', '历史', '博物馆', '古城', '老街',
        '预算', '花费', '性价比', '省钱',
        '旅行博主', 'vlog', '旅拍',
        '度假', '周末游', '短途', '长途'
      ],

      [this.TAGS.HOME]: [
        '家居', '生活方式', '居家', '日常生活', '家',
        '装修', '设计', '软装', '硬装', '全屋定制',
        '风格', '北欧', '日式', '现代', '原木', '极简',
        '客厅', '卧室', '厨房', '卫生间', '阳台',
        '家具', '沙发', '床', '桌子', '椅子', '柜子',
        '收纳', '整理', '断舍离', '空间利用',
        '灯光', '照明', '氛围灯',
        '家电', '冰箱', '洗衣机', '烘干机', '空调',
        '扫地机器人', '洗碗机',
        '清洁', '打扫', '家务',
        '香薰', '蜡烛', '气味',
        '绿植', '盆栽', '养花',
        '居住体验', '舒适', '幸福感',
        '搬家', '租房改造',
        '生活美学', '慢生活'
      ],

      [this.TAGS.PETS]: [
        '宠物', '萌宠', '养宠', '铲屎官',
        '猫', '狗', '猫咪', '狗狗',
        '英短', '美短', '布偶', '橘猫', '蓝猫',
        '柴犬', '金毛', '拉布拉多', '比熊', '博美', '柯基',
        '幼猫', '幼犬', '成猫', '成犬',
        '喂养', '粮', '猫粮', '狗粮', '罐头', '冻干',
        '零食', '营养', '补充剂',
        '猫砂', '猫砂盆', '狗厕所',
        '洗澡', '美容', '修毛',
        '疫苗', '驱虫', '体检', '绝育',
        '生病', '拉稀', '呕吐', '皮肤病',
        '行为', '拆家', '粘人', '胆小',
        '互动', '陪伴', '治愈',
        '宠物医院', '宠物医生',
        '宠物用品', '宠物背包',
        '领养', '送养'
      ],

      [this.TAGS.PARENTING]: [
        '母婴', '育儿', '带娃', '新手爸妈',
        '怀孕', '孕期', '产检', '分娩', '顺产', '剖宫产',
        '坐月子', '产后', '恢复',
        '宝宝', '新生儿', '婴儿', '幼儿',
        '喂奶', '母乳', '奶粉', '辅食', '断奶',
        '睡眠', '哄睡', '作息',
        '生长发育', '身高', '体重',
        '疫苗', '体检', '儿保',
        '感冒', '发烧', '腹泻',
        '早教', '启蒙', '绘本', '亲子阅读',
        '幼儿园', '入园', '适应',
        '教育理念', '鸡娃', '放养',
        '亲子关系', '陪伴',
        '育儿焦虑', '经验分享',
        '母婴用品', '尿不湿', '奶瓶', '推车'
      ],

      [this.TAGS.EMOTION]: [
        '情感', '情绪', '治愈', '疗愈',
        '快乐', '幸福', '满足',
        '难过', '低落', '失落', '焦虑', '抑郁',
        '压力', '内耗', '崩溃',
        '孤独', '陪伴', '安全感',
        '自我', '成长', '和解',
        '释怀', '放下', '接受',
        '安慰', '共鸣', '理解',
        '情绪价值',
        '心理', '心理状态', '情绪管理',
        '冥想', '正念', '呼吸',
        '文字', '句子', '语录',
        '深夜', '夜晚', '失眠',
        '故事', '倾诉',
        '温柔', '力量',
        '慢慢来',
        '治愈系',
        '情感博主'
      ],

      [this.TAGS.RELATIONSHIP]: [
        '人际', '社交', '关系',
        '朋友', '友情', '闺蜜', '兄弟',
        '同事', '职场关系',
        '相处', '沟通', '交流',
        '表达', '倾听',
        '边界感', '分寸',
        '冲突', '矛盾', '误会',
        '和解', '冷处理',
        '讨好型人格', '回避型', '依恋',
        '信任', '尊重',
        '社恐', '社牛',
        '饭局', '应酬',
        '人情世故',
        '情商', '说话技巧',
        '拒绝', '拒绝内耗',
        '关系断舍离',
        '成年人的关系',
        '圈子', '社交圈',
        '链接', '资源',
        '相互成就'
      ],

      [this.TAGS.LIFE]: [
        '生活', '日常', '随手拍',
        '记录', '分享',
        '一天', '今天',
        '碎片化', '普通生活',
        '早晨', '中午', '夜晚',
        '上班', '下班',
        '通勤', '地铁', '公交',
        '周末', '假期',
        '居家', '宅家',
        '天气', '下雨', '晴天',
        '咖啡', '喝水',
        '做饭', '吃饭',
        '散步', '发呆',
        '拍照', 'vlog',
        '情绪', '心情',
        '生活感',
        '慢慢过',
        '普通但真实',
        '生活碎片',
        '记录美好',
        '日常幸福'
      ],

      [this.TAGS.NEWS]: [
        '新闻', '社会', '热点',
        '时事', '要闻', '快讯',
        '官方通报', '公告',
        '政策', '法规', '文件',
        '舆论', '讨论', '热搜',
        '事件', '通报', '回应',
        '调查', '进展', '结果',
        '安全', '事故',
        '民生', '公共服务',
        '教育', '医疗', '住房',
        '就业', '经济',
        '城市', '地方',
        '网络舆情',
        '谣言', '辟谣',
        '权威发布',
        '媒体', '记者',
        '新闻发布会',
        '社会问题',
        '公共议题'
      ],

      [this.TAGS.SCIENCE]: [
        '科学', '科普', '研究',
        '实验', '实验室',
        '理论', '模型',
        '物理', '化学', '生物',
        '天文', '宇宙', '星系',
        '量子', '相对论',
        '地球', '气候', '环境',
        '生态', '进化',
        '基因', 'DNA',
        '大脑', '神经',
        '认知', '意识',
        '科学家', '诺贝尔奖',
        '论文', '期刊',
        '数据', '证据',
        '事实', '逻辑',
        '辟谣', '伪科学',
        '实验结果',
        '科学史',
        '技术原理',
        '科学思维'
      ],

      [this.TAGS.HISTORY]: [
        '历史', '考古',
        '朝代', '古代', '近代', '现代',
        '文明', '文化',
        '文物', '遗址', '古墓',
        '出土', '发掘',
        '史书', '史料',
        '正史', '野史',
        '人物', '帝王', '名将',
        '战争', '变革',
        '王朝', '更替',
        '制度', '政治',
        '社会结构',
        '思想', '哲学',
        '宗教',
        '时间线',
        '历史事件',
        '历史真相',
        '历史细节',
        '冷知识',
        '考据',
        '历史故事',
        '文明比较'
      ],
    };

  }
  
  /**
   * 提取文本中的 # 标签 (权重计算核心)
   */
  extractHashtags(text) {
    if (!text) return [];
    const hashtagRegex = /#([^\s#]+)/g;
    const matches = text.match(hashtagRegex);
    return matches ? matches.map(tag => tag.substring(1).trim()).filter(t => t.length > 0) : [];
  }
  
  /**
   * 关键词匹配得分 (支持正则逃逸)
   */
  matchKeywords(text, tag) {
    if (!text || !this.keywords[tag]) return 0;
    const lowerText = text.toLowerCase();
    let score = 0;
    
    this.keywords[tag].forEach(kw => {
      const lowerKw = kw.toLowerCase();
      // 这里使用简单的包含检查提升性能，或者正则匹配提升精度
      const regex = new RegExp(lowerKw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      const matches = lowerText.match(regex);
      if (matches) score += matches.length;
    });
    return score;
  }
  
  /**
   * 综合标签判断 (核心算法)
   */
  tag(content) {
    let text = typeof content === 'string' ? content : (content?.text || content?.fullText || '');
    if (!text || text.trim().length === 0) return this.TAGS.UNKNOWN;
    
    const hashtags = this.extractHashtags(text);
    const hashtagText = hashtags.join(' ');
    
    const scores = {};
    const allTags = Object.keys(this.keywords);
    
    allTags.forEach(tag => {
      // 1. 正文匹配分
      const textScore = this.matchKeywords(text, tag);
      // 2. 话题加权分 (x5, 因为 #话题 是极高特征)
      const hashtagScore = this.matchKeywords(hashtagText, tag) * 5;
      
      scores[tag] = textScore + hashtagScore;
    });
    
    // 找出得分最高的
    let maxScore = 0;
    let bestTag = this.TAGS.UNKNOWN;
    
    Object.keys(scores).forEach(tag => {
      if (scores[tag] > maxScore) {
        maxScore = scores[tag];
        bestTag = tag;
      }
    });
    
    return maxScore > 0 ? bestTag : this.TAGS.UNKNOWN;
  }
  
  /**
   * 获取标签中文名称
   */
  getTagName(tag) {
    const names = {
      [this.TAGS.TECH]: '科技', [this.TAGS.LEARNING]: '学习', [this.TAGS.FINANCE]: '财经',
      [this.TAGS.CAREER]: '职场', [this.TAGS.HEALTH]: '健康', [this.TAGS.SPORTS]: '运动',
      [this.TAGS.OUTDOOR]: '户外', [this.TAGS.AUTO]: '汽车', [this.TAGS.GAME]: '游戏',
      [this.TAGS.MOVIE]: '影视', [this.TAGS.BOOK]: '书籍', [this.TAGS.ART]: '艺术',
      [this.TAGS.DESIGN]: '设计', [this.TAGS.PHOTO]: '摄影', [this.TAGS.FASHION]: '时尚',
      [this.TAGS.BEAUTY]: '美妆', [this.TAGS.FOOD]: '美食', [this.TAGS.TRAVEL]: '旅行',
      [this.TAGS.HOME]: '家居', [this.TAGS.PETS]: '宠物', [this.TAGS.PARENTING]: '育儿',
      [this.TAGS.EMOTION]: '情感', [this.TAGS.RELATIONSHIP]: '社交', [this.TAGS.LIFE]: '生活',
      [this.TAGS.NEWS]: '新闻', [this.TAGS.SCIENCE]: '科学', [this.TAGS.HISTORY]: '历史',
      [this.TAGS.REAL_ESTATE]: '房产', [this.TAGS.LEGAL]: '法律', [this.TAGS.UNKNOWN]: '未知'
    };
    return names[tag] || '未知';
  }
}

// 注入全局
if (typeof window !== 'undefined') {
  window.ContentTagger = ContentTagger;
}